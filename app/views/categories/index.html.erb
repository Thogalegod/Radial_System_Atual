<div class="content-header">
  <h1 class="page-title">Controle de Estoque - Categorias</h1>
</div>

<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
    <h2 style="font-size: 20px; font-weight: 600; color: #1f2937;">Categorias de Equipamentos</h2>
    <button class="btn btn-primary" onclick="openModal('categoryModal')">
      <span>+</span>
      <span>Adicionar Categoria</span>
    </button>
  </div>

  <% if @categories.any? %>
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Descri√ß√£o</th>
          <th>Quantidade de Equipamentos</th>
          <th>Cor</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <% @categories.each do |category| %>
          <tr>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 12px; height: 12px; border-radius: 50%; background-color: <%= category.color %>;"></div>
                <strong><%= category.display_name %></strong>
              </div>
            </td>
            <td><%= category.description %></td>
            <td>
              <span class="badge badge-secondary">
                <%= category.equipment_count %> equipamento<%= 's' if category.equipment_count != 1 %>
              </span>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 20px; height: 20px; border-radius: 4px; background-color: <%= category.color %>; border: 1px solid #e5e7eb;"></div>
                <span style="font-family: monospace; font-size: 12px;"><%= category.color %></span>
              </div>
            </td>
            <td>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary btn-icon" onclick="openEditModal('<%= category.id %>')" title="Editar">
                  ‚úèÔ∏è
                </button>
                <% if category.can_be_deleted? %>
                  <%= form_with url: category_path(category), method: :delete, local: true, style: "display: inline;", html: { onsubmit: "return confirmDelete('#{category.display_name}')" } do |form| %>
                    <%= form.submit 'üóëÔ∏è', class: 'btn btn-danger btn-icon', title: 'Excluir' %>
                  <% end %>
                <% else %>
                  <button class="btn btn-danger btn-icon" disabled title="N√£o pode ser exclu√≠da - possui equipamentos">
                    üóëÔ∏è
                  </button>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div style="text-align: center; padding: 48px 24px; color: #6b7280;">
      <div style="font-size: 48px; margin-bottom: 16px;">üìÇ</div>
      <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Nenhuma categoria cadastrada</h3>
      <p style="margin-bottom: 24px;">Comece criando sua primeira categoria de equipamentos</p>
      <button class="btn btn-primary" onclick="openModal('categoryModal')">
        <span>+</span>
        <span>Adicionar Categoria</span>
      </button>
    </div>
  <% end %>
</div>

<!-- Modal para Adicionar/Editar Categoria -->
<div id="categoryModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Adicionar Categoria</h3>
      <button class="modal-close" onclick="closeModal('categoryModal')">&times;</button>
    </div>
    
    <%= form_with model: @category || Category.new, local: true, html: { id: 'categoryForm' } do |form| %>
      <div class="modal-body">
        <div class="form-group">
          <%= form.label :name, "Nome da Categoria", class: "form-label" %>
          <%= form.text_field :name, class: "form-input", placeholder: "Ex: Transformador MT" %>
        </div>

        <div class="form-group">
          <%= form.label :description, "Descri√ß√£o", class: "form-label" %>
          <%= form.text_area :description, class: "form-input", rows: 3, placeholder: "Descri√ß√£o da categoria..." %>
        </div>

        <div class="form-group">
          <%= form.label :color, "Cor", class: "form-label" %>
          <div style="display: flex; align-items: center; gap: 12px;">
            <%= form.color_field :color, class: "form-input", style: "width: 60px; height: 40px; padding: 4px;" %>
            <span style="font-size: 14px; color: #6b7280;">Escolha uma cor para identificar esta categoria</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('categoryModal')">Cancelar</button>
        <%= form.submit "Salvar", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<script>
function openModal(modalId) {
  document.getElementById(modalId).style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
  document.body.style.overflow = 'auto';
}

function openEditModal(categoryId) {
  // Aqui voc√™ pode implementar a l√≥gica para carregar os dados da categoria
  // Por enquanto, vamos redirecionar para a p√°gina de edi√ß√£o
  window.location.href = `/categories/${categoryId}/edit`;
}

function confirmDelete(categoryName) {
  return confirm(`Tem certeza que deseja excluir a categoria "${categoryName}"?`);
}

// Fechar modal ao clicar fora dele
document.addEventListener('click', function(event) {
  if (event.target.classList.contains('modal-overlay')) {
    event.target.style.display = 'none';
    document.body.style.overflow = 'auto';
  }
});
</script>
